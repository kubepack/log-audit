# Welcome

Log-audit server is a log server for [kubepack](https://github.com/kubepack/kubepack). Log audit uses webhook and audit to communicate with kubernetes apiserver.
kubernetes apiserver sends events to log-audit server using webhook. 
Then, log-audit server saves these events to database(log-audit uses [goleveldb](https://github.com/syndtr/goleveldb) for store data).

### Test Process

- Run `main.go` by `go run main.go`
- Replace `<PRIMARY_NETWORK_INTERFACE_IP>` in `minikube/1.9/auditing/hit-config.yaml` file with local computer's `PRIMARY_NETWORK_INTERFACE_IP`
- Run `restart.sh` from `minikube/1.9/auditing` directory.
This command copies `audit-policy.yaml`, `kube-apiserver.yaml` and `hit-config.yaml` files into `~/minikube/files` folder. 
Then `minikube` will mount this folder inside the `Minikube VM` as `tmp/files` folder.
- Once minikube is running, ssh into minikube and run following command:

```console
minikube ssh
# inside minikube vm
sudo cp /tmp/files/kube-apiserver.yaml /etc/kubernetes/manifests/kube-apiserver.yaml
```

- Log-audit server store logs, only which events are generated by objects which are annotated with `git-commit-hash`.
- Deploy some app using [kubepack](https://github.com/kubepack/kubepack). 
- Go to [http://localhost:8080/get-logs](http://localhost:8080/get-logs) to see the logs.
